<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 560" font-family="'Segoe UI', system-ui, -apple-system, sans-serif">
  <defs>
    <linearGradient id="sbg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#0d1117"/><stop offset="100%" stop-color="#161b22"/>
    </linearGradient>
    <filter id="ss">
      <feDropShadow dx="0" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>

  <rect width="900" height="560" fill="url(#sbg)"/>
  <text x="450" y="32" text-anchor="middle" fill="#e6edf3" font-size="18" font-weight="700">Scanline Polygon Rasterization</text>
  <text x="450" y="50" text-anchor="middle" fill="#8b949e" font-size="10">How draw_polygon_1bipp fills a polygon using horizontal scanlines</text>

  <!-- Step 1: Vertex Input -->
  <g transform="translate(30, 75)">
    <rect width="250" height="200" rx="8" fill="#1a1a2e" filter="url(#ss)" stroke="#30363d" stroke-width="1"/>
    <text x="125" y="22" text-anchor="middle" fill="#a78bfa" font-size="12" font-weight="700">① Define Vertices</text>

    <!-- Coordinate system -->
    <line x1="30" y1="45" x2="30" y2="185" stroke="#30363d" stroke-width="1"/>
    <line x1="30" y1="185" x2="230" y2="185" stroke="#30363d" stroke-width="1"/>
    <text x="25" y="42" text-anchor="end" fill="#484f58" font-size="7">y</text>
    <text x="233" y="190" fill="#484f58" font-size="7">x</text>

    <!-- Polygon vertices -->
    <polygon points="60,60 200,80 180,170 100,175 40,130" fill="none" stroke="#a78bfa" stroke-width="1.5" stroke-dasharray="4,3"/>
    <circle cx="60" cy="60" r="4" fill="#a78bfa"/><text x="52" y="55" fill="#c4b5fd" font-size="8">P0</text>
    <circle cx="200" cy="80" r="4" fill="#a78bfa"/><text x="207" y="78" fill="#c4b5fd" font-size="8">P1</text>
    <circle cx="180" cy="170" r="4" fill="#a78bfa"/><text x="187" y="168" fill="#c4b5fd" font-size="8">P2</text>
    <circle cx="100" cy="175" r="4" fill="#a78bfa"/><text x="87" y="185" fill="#c4b5fd" font-size="8">P3</text>
    <circle cx="40" cy="130" r="4" fill="#a78bfa"/><text x="25" y="128" fill="#c4b5fd" font-size="8">P4</text>
  </g>

  <!-- Step 2: Edge Table -->
  <g transform="translate(310, 75)">
    <rect width="250" height="200" rx="8" fill="#1a1a2e" filter="url(#ss)" stroke="#30363d" stroke-width="1"/>
    <text x="125" y="22" text-anchor="middle" fill="#22c55e" font-size="12" font-weight="700">② Build Edge Table</text>

    <g transform="translate(15, 38)">
      <!-- Table header -->
      <rect width="220" height="20" rx="3" fill="#22c55e" opacity="0.2"/>
      <text x="30" y="14" text-anchor="middle" fill="#86efac" font-size="8" font-weight="600">Edge</text>
      <text x="85" y="14" text-anchor="middle" fill="#86efac" font-size="8" font-weight="600">y_min</text>
      <text x="135" y="14" text-anchor="middle" fill="#86efac" font-size="8" font-weight="600">y_max</text>
      <text x="188" y="14" text-anchor="middle" fill="#86efac" font-size="8" font-weight="600">x_at_ymin</text>

      <!-- Rows -->
      <rect y="22" width="220" height="18" rx="2" fill="#161b22"/><text x="30" y="35" text-anchor="middle" fill="#c9d1d9" font-size="8">P0→P1</text><text x="85" y="35" text-anchor="middle" fill="#8b949e" font-size="8">60</text><text x="135" y="35" text-anchor="middle" fill="#8b949e" font-size="8">80</text><text x="188" y="35" text-anchor="middle" fill="#8b949e" font-size="8">60</text>
      <rect y="42" width="220" height="18" rx="2" fill="#1c2333"/><text x="30" y="55" text-anchor="middle" fill="#c9d1d9" font-size="8">P1→P2</text><text x="85" y="55" text-anchor="middle" fill="#8b949e" font-size="8">80</text><text x="135" y="55" text-anchor="middle" fill="#8b949e" font-size="8">170</text><text x="188" y="55" text-anchor="middle" fill="#8b949e" font-size="8">200</text>
      <rect y="62" width="220" height="18" rx="2" fill="#161b22"/><text x="30" y="75" text-anchor="middle" fill="#c9d1d9" font-size="8">P2→P3</text><text x="85" y="75" text-anchor="middle" fill="#8b949e" font-size="8">170</text><text x="135" y="75" text-anchor="middle" fill="#8b949e" font-size="8">175</text><text x="188" y="75" text-anchor="middle" fill="#8b949e" font-size="8">180</text>
      <rect y="82" width="220" height="18" rx="2" fill="#1c2333"/><text x="30" y="95" text-anchor="middle" fill="#c9d1d9" font-size="8">P3→P4</text><text x="85" y="95" text-anchor="middle" fill="#8b949e" font-size="8">130</text><text x="135" y="95" text-anchor="middle" fill="#8b949e" font-size="8">175</text><text x="188" y="95" text-anchor="middle" fill="#8b949e" font-size="8">40</text>
      <rect y="102" width="220" height="18" rx="2" fill="#161b22"/><text x="30" y="115" text-anchor="middle" fill="#c9d1d9" font-size="8">P4→P0</text><text x="85" y="115" text-anchor="middle" fill="#8b949e" font-size="8">60</text><text x="135" y="115" text-anchor="middle" fill="#8b949e" font-size="8">130</text><text x="188" y="115" text-anchor="middle" fill="#8b949e" font-size="8">60</text>
    </g>

    <text x="125" y="180" text-anchor="middle" fill="#6b7280" font-size="8">Polygon_Edges + Polygon_Scanline_Edges</text>
    <text x="125" y="193" text-anchor="middle" fill="#6b7280" font-size="8">sort by y_min, track active edges</text>
  </g>

  <!-- Step 3: Scanline Fill -->
  <g transform="translate(590, 75)">
    <rect width="280" height="200" rx="8" fill="#1a1a2e" filter="url(#ss)" stroke="#30363d" stroke-width="1"/>
    <text x="140" y="22" text-anchor="middle" fill="#0ea5e9" font-size="12" font-weight="700">③ Scanline Fill</text>

    <!-- Grid with scanlines -->
    <g transform="translate(25, 38)">
      <!-- Polygon outline -->
      <polygon points="30,15 170,28 155,120 75,123 15,80" fill="#0ea5e9" fill-opacity="0.1" stroke="#0ea5e9" stroke-width="1"/>

      <!-- Scanlines -->
      <line x1="5" y1="35" x2="230" y2="35" stroke="#30363d" stroke-width="0.5" stroke-dasharray="2,4"/>
      <line x1="5" y1="55" x2="230" y2="55" stroke="#30363d" stroke-width="0.5" stroke-dasharray="2,4"/>
      <line x1="5" y1="75" x2="230" y2="75" stroke="#30363d" stroke-width="0.5" stroke-dasharray="2,4"/>
      <line x1="5" y1="95" x2="230" y2="95" stroke="#30363d" stroke-width="0.5" stroke-dasharray="2,4"/>

      <!-- Active fill spans -->
      <rect x="22" y="32" width="145" height="6" rx="2" fill="#0ea5e9" opacity="0.5"/>
      <rect x="18" y="52" width="150" height="6" rx="2" fill="#0ea5e9" opacity="0.6"/>
      <rect x="15" y="72" width="155" height="6" rx="2" fill="#0ea5e9" opacity="0.7"/>
      <rect x="30" y="92" width="138" height="6" rx="2" fill="#0ea5e9" opacity="0.8"/>

      <!-- x-span labels -->
      <text x="200" y="38" fill="#7dd3fc" font-size="7">y=70: x[22..167]</text>
      <text x="200" y="58" fill="#7dd3fc" font-size="7">y=90: x[18..168]</text>
      <text x="200" y="78" fill="#7dd3fc" font-size="7">y=110: x[15..170]</text>
      <text x="200" y="98" fill="#7dd3fc" font-size="7">y=130: x[30..168]</text>
    </g>

    <text x="140" y="180" text-anchor="middle" fill="#6b7280" font-size="8">ScanlineProcessor sweeps top→bottom</text>
    <text x="140" y="193" text-anchor="middle" fill="#6b7280" font-size="8">draw_x_span_on_1bipp for each span</text>
  </g>

  <!-- === Bresenham Line Section === -->
  <g transform="translate(30, 310)">
    <rect width="400" height="230" rx="8" fill="#1a1a2e" filter="url(#ss)" stroke="#30363d" stroke-width="1"/>
    <text x="200" y="25" text-anchor="middle" fill="#f97316" font-size="14" font-weight="700">Line Rasterization (Bresenham)</text>

    <!-- Grid -->
    <g transform="translate(30, 45)">
      <!-- Grid lines -->
      <g stroke="#1e2a3a" stroke-width="0.5">
        <line x1="0" y1="0" x2="340" y2="0"/><line x1="0" y1="25" x2="340" y2="25"/>
        <line x1="0" y1="50" x2="340" y2="50"/><line x1="0" y1="75" x2="340" y2="75"/>
        <line x1="0" y1="100" x2="340" y2="100"/><line x1="0" y1="125" x2="340" y2="125"/>
        <line x1="0" y1="150" x2="340" y2="150"/>
        <line x1="0" y1="0" x2="0" y2="150"/><line x1="25" y1="0" x2="25" y2="150"/>
        <line x1="50" y1="0" x2="50" y2="150"/><line x1="75" y1="0" x2="75" y2="150"/>
        <line x1="100" y1="0" x2="100" y2="150"/><line x1="125" y1="0" x2="125" y2="150"/>
        <line x1="150" y1="0" x2="150" y2="150"/><line x1="175" y1="0" x2="175" y2="150"/>
        <line x1="200" y1="0" x2="200" y2="150"/><line x1="225" y1="0" x2="225" y2="150"/>
        <line x1="250" y1="0" x2="250" y2="150"/><line x1="275" y1="0" x2="275" y2="150"/>
        <line x1="300" y1="0" x2="300" y2="150"/><line x1="325" y1="0" x2="325" y2="150"/>
      </g>

      <!-- Ideal line -->
      <line x1="12" y1="12" x2="312" y2="137" stroke="#f97316" stroke-width="1" opacity="0.4" stroke-dasharray="3,3"/>

      <!-- Rasterized pixels -->
      <rect x="1" y="1" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="26" y="1" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="51" y="26" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="76" y="26" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="101" y="51" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="126" y="51" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="151" y="76" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="176" y="76" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="201" y="101" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="226" y="101" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="251" y="126" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="276" y="126" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>
      <rect x="301" y="126" width="23" height="23" rx="2" fill="#f97316" opacity="0.8"/>

      <!-- Start/end labels -->
      <circle cx="12" cy="12" r="5" fill="#22c55e"/><text x="12" y="15" text-anchor="middle" fill="#fff" font-size="6" font-weight="700">S</text>
      <circle cx="312" cy="137" r="5" fill="#ef4444"/><text x="312" y="140" text-anchor="middle" fill="#fff" font-size="6" font-weight="700">E</text>
    </g>
  </g>

  <!-- === Rectangle / Painter Section === -->
  <g transform="translate(470, 310)">
    <rect width="400" height="230" rx="8" fill="#1a1a2e" filter="url(#ss)" stroke="#30363d" stroke-width="1"/>
    <text x="200" y="25" text-anchor="middle" fill="#14b8a6" font-size="14" font-weight="700">Pixel_Buffer_Painter — Rectangle Chaining</text>

    <!-- Code example -->
    <g transform="translate(20, 45)">
      <rect width="360" height="70" rx="4" fill="#161b22" stroke="#30363d" stroke-width="1"/>
      <text x="10" y="16" fill="#8b949e" font-size="9" font-family="monospace">painter</text>
      <text x="10" y="30" fill="#14b8a6" font-size="9" font-family="monospace">  .rect([10,10], [80,40], [255,0,0])</text>
      <text x="10" y="44" fill="#14b8a6" font-size="9" font-family="monospace">  .rect([30,30], [80,40], [0,255,0])</text>
      <text x="10" y="58" fill="#14b8a6" font-size="9" font-family="monospace">  .rect([50,20], [80,40], [0,0,255]);</text>
    </g>

    <!-- Visual result -->
    <g transform="translate(100, 130)">
      <rect width="200" height="85" rx="4" fill="#161b22" stroke="#30363d" stroke-width="1"/>
      <!-- Rectangles overlapping -->
      <rect x="10" y="10" width="80" height="40" rx="2" fill="#ef4444" opacity="0.7"/>
      <rect x="30" y="30" width="80" height="40" rx="2" fill="#22c55e" opacity="0.7"/>
      <rect x="50" y="20" width="80" height="40" rx="2" fill="#3b82f6" opacity="0.7"/>
    </g>
  </g>
</svg>
